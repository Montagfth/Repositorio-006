<!-- Página de Locales - Pizzería Deliziosa -->

<!-- Hero Section de Locales -->
<section class="locales-hero d-flex align-items-center justify-content-center text-center text-white position-relative">
  <!-- Overlay -->
  <div class="hero-overlay position-absolute top-0 start-0 w-100 h-100"></div>

  <!-- Contenido del hero -->
  <div class="container position-relative z-3" [class.hero-loaded]="isLoaded()">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <h1 class="hero-title display-2 fw-bold mb-4 text-glow">
          Nuestros Locales
        </h1>
        <p class="hero-subtitle lead mb-4">
          Encuentra la Pizzería Deliziosa más cerca de ti.<br>
          <strong class="text-warning">¡{{ totalLocales() }} ubicaciones en Lima para servirte mejor!</strong>
        </p>

        <!-- Estadísticas rápidas -->
        <div class="hero-stats row g-3 justify-content-center">
          <div class="col-auto">
            <div class="stat-card">
              <div class="stat-number h2 fw-bold text-warning">{{ totalLocales() }}</div>
              <div class="stat-label">Locales</div>
            </div>
          </div>
          <div class="col-auto">
            <div class="stat-card">
              <div class="stat-number h2 fw-bold text-success">{{ zonasDisponibles().length }}</div>
              <div class="stat-label">Zonas</div>
            </div>
          </div>
          <div class="col-auto">
            <div class="stat-card">
              <div class="stat-number h2 fw-bold text-info">7</div>
              <div class="stat-label">Días/Semana</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scroll indicator -->
  <div class="scroll-indicator position-absolute bottom-0 start-50 translate-middle-x mb-4">
    <i class="bi bi-chevron-down text-white fs-2 animate-bounce"></i>
  </div>
</section>

<!-- Sección de Locales Destacados -->
<section class="featured-locales py-5 bg-light">
  <div class="container">
    <div class="section-header text-center mb-5">
      <h2 class="section-title display-4 fw-bold text-primary mb-3">
        <i class="bi bi-star-fill me-3"></i>
        Locales Destacados
      </h2>
      <p class="lead text-muted">
        Nuestros locales más populares con las mejores ubicaciones y servicios
      </p>
    </div>

    <!-- Grid de locales destacados -->
    <div class="row g-4">
      @for (local of localesDestacados(); track local.id; let idx = $index) {
        <div class="col-lg-4 col-md-6">
          <div class="featured-local-card card border-0 shadow-lg h-100">
            <!-- Imagen del local -->
            <div class="local-image position-relative overflow-hidden">
              <img [src]="getImagenLocal(idx)" [alt]="local.nombre" class="card-img-top">
              <div class="local-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center">
                <button class="btn btn-light btn-lg rounded-circle shadow" (click)="seleccionarLocal(local)">
                  <i class="bi bi-eye fs-4"></i>
                </button>
              </div>
              <div class="local-badge position-absolute top-0 end-0 m-3">
                <span class="badge bg-warning text-dark px-3 py-2 rounded-pill">
                  <i class="bi bi-star-fill me-1"></i>
                  Destacado
                </span>
              </div>
              <!-- Estado del local -->
              <div class="local-status position-absolute bottom-0 start-0 m-3">
                <span class="badge px-3 py-2 rounded-pill"
                      [class]="isLocalActivo(local) ? 'bg-success' : 'bg-danger'">
                  <i class="bi bi-clock me-1"></i>
                  {{ isLocalActivo(local) ? 'Abierto' : 'Cerrado' }}
                </span>
              </div>
            </div>

            <!-- Contenido de la card -->
            <div class="card-body p-4">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <span class="badge rounded-pill bg-info">
                  <i class="bi bi-geo-alt me-1"></i>
                  {{ local.ciudad }}
                </span>
                <div class="text-end">
                  <div class="capacity h6 fw-bold text-primary mb-0">{{ local.capacidad }}</div>
                  <small class="text-muted">personas</small>
                </div>
              </div>

              <h3 class="card-title h5 fw-bold mb-3">{{ local.nombre }}</h3>

              <!-- Información del local -->
              <div class="local-info mb-3">
                <div class="info-item d-flex align-items-start mb-2">
                  <i class="bi bi-geo-alt-fill text-primary me-2 mt-1"></i>
                  <span class="fw-semibold">{{ local.direccion }}, {{ local.ciudad }}</span>
                </div>
                <div class="info-item d-flex align-items-center mb-2">
                  <i class="bi bi-telephone text-primary me-2"></i>
                  <span>{{ local.telefono }}</span>
                </div>
                <div class="info-item d-flex align-items-center mb-2">
                  <i class="bi bi-envelope text-primary me-2"></i>
                  <span>{{ local.email }}</span>
                </div>
                <div class="info-item d-flex align-items-center">
                  <i class="bi bi-clock text-primary me-2"></i>
                  <span>{{ formatearHorario(local.horarioApertura, local.horarioCierre) }}</span>
                </div>
              </div>
            </div>

            <!-- Footer de la card -->
            <div class="card-footer bg-transparent border-0 p-4 pt-0">
              <div class="d-grid gap-2">
                <button class="btn btn-primary w-100 fw-semibold" (click)="llamarLocal(local.telefono!)">
                  <i class="bi bi-telephone me-1"></i>
                  Llamar
                </button>
                <button class="btn btn-outline-secondary" (click)="seleccionarLocal(local)">
                  <i class="bi bi-info-circle me-2"></i>
                  Ver Detalles Completos
                </button>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  </div>
</section>

<!-- Sección Principal de Locales -->
<section class="main-locales py-5">
  <div class="container">

    <!-- Filtros por zona -->
    <div class="locales-filters mb-5">
      <div class="row align-items-center">
        <div class="col-md-6">
          <h2 class="section-title h3 fw-bold text-primary mb-md-0">
            Todos Nuestros Locales
          </h2>
        </div>
        <div class="col-md-6">
          <div class="filter-buttons text-md-end">
            <div class="btn-group" role="group">
              <button
                type="button"
                class="btn fw-semibold"
                [class]="filtroZona() === 'todos' ? 'btn-primary' : 'btn-outline-primary'"
                (click)="setFiltroZona('todos')">
                <i class="bi bi-grid-3x3-gap me-1"></i>
                Todos
              </button>
              @for (zona of zonasDisponibles(); track zona.value) {
                <button
                  type="button"
                  class="btn fw-semibold"
                  [class]="filtroZona() === zona.value ? 'btn-info' : 'btn-outline-info'"
                  (click)="setFiltroZona(zona.value)">
                  <i class="bi bi-geo-alt me-1"></i>
                  {{ zona.label }} ({{ zona.count }})
                </button>
              }
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Grid de todos los locales -->
    <div class="locales-grid">
      <div class="row g-4">
        @for (local of localesPorZona(); track local.id; let idx = $index) {
          <div class="col-lg-6 col-xl-4">
            <div class="local-card card border-0 shadow h-100 position-relative">

              <!-- Imagen -->
              <div class="local-image-container position-relative overflow-hidden">
                <img [src]="getImagenLocal(idx)" [alt]="local.nombre" class="card-img-top local-image">

                <!-- Overlay con información -->
                <div class="local-quick-info position-absolute bottom-0 start-0 end-0 p-3">
                  <div class="d-flex justify-content-between align-items-end">
                    <div class="local-zone bg-white rounded-3 p-2 text-center">
                      <i class="bi bi-geo-alt text-primary mb-1"></i>
                      <div class="zone-name small fw-bold text-dark">{{ local.ciudad }}</div>
                    </div>
                    <div class="local-capacity bg-primary text-white rounded-3 p-2">
                      <div class="capacity-amount fw-bold">{{ local.capacidad }}</div>
                      <div class="capacity-label small">personas</div>
                    </div>
                  </div>
                </div>

                <!-- Estado (abierto/cerrado) -->
                <div class="status-badge position-absolute top-0 start-0 m-3">
                  <span class="badge px-3 py-2 rounded-pill"
                        [class]="isLocalActivo(local) ? 'bg-success' : 'bg-danger'">
                    <i class="bi bi-clock-fill me-1"></i>
                    {{ isLocalActivo(local) ? 'Abierto' : 'Cerrado' }}
                  </span>
                </div>
              </div>

              <!-- Contenido -->
              <div class="card-body p-4">
                <h3 class="card-title h5 fw-bold mb-2">{{ local.nombre }}</h3>

                <!-- Detalles del local -->
                <div class="local-details mb-3">
                  <div class="detail-row d-flex align-items-start mb-2">
                    <i class="bi bi-geo-alt text-muted me-2 mt-1"></i>
                    <small class="text-muted flex-grow-1">{{ local.direccion }}, {{ local.ciudad }}</small>
                  </div>
                  <div class="detail-row d-flex align-items-center mb-2">
                    <i class="bi bi-telephone text-muted me-2"></i>
                    <small class="text-muted">{{ local.telefono }}</small>
                  </div>
                  <div class="detail-row d-flex align-items-center mb-2">
                    <i class="bi bi-clock text-muted me-2"></i>
                    <small class="text-muted">{{ formatearHorario(local.horarioApertura, local.horarioCierre) }}</small>
                  </div>
                  <div class="detail-row d-flex align-items-center">
                    <i class="bi bi-envelope text-muted me-2"></i>
                    <small class="text-muted">{{ local.email }}</small>
                  </div>
                </div>
              </div>

              <!-- Footer -->
              <div class="card-footer bg-transparent border-0 p-4 pt-0">
                <div class="d-grid gap-2">
                  <button class="btn btn-primary w-100" (click)="llamarLocal(local.telefono!)">
                    <i class="bi bi-telephone me-2"></i>
                    Llamar al Local
                  </button>
                  <button class="btn btn-outline-primary" (click)="seleccionarLocal(local)">
                    <i class="bi bi-eye me-2"></i>
                    Ver Información Completa
                  </button>
                </div>
              </div>
            </div>
          </div>
        }
      </div>

      <!-- Mensaje cuando no hay locales -->
      @if (localesPorZona().length === 0) {
        <div class="no-locales text-center py-5">
          <i class="bi bi-shop text-muted" style="font-size: 4rem;"></i>
          <h3 class="h4 text-muted mt-3">No hay locales en esta zona</h3>
          <p class="text-muted">Para este filtro no encontramos locales disponibles.</p>
          <button class="btn btn-primary" (click)="setFiltroZona('todos')">
            <i class="bi bi-grid-3x3-gap me-2"></i>
            Ver Todos los Locales
          </button>
        </div>
      }
    </div>
  </div>
</section>

<!-- Modal de Detalles del Local -->
@if (localSeleccionado()) {
  <div class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content shadow-lg border-0 rounded-4">

        <!-- Header del modal -->
        <div class="modal-header border-0 pb-0">
          <div class="d-flex align-items-center">
            <span class="badge rounded-pill bg-info me-3">
              <i class="bi bi-geo-alt me-1"></i>
              {{ localSeleccionado()!.ciudad }}
            </span>
            <span class="badge rounded-pill ms-2"
                  [class]="isLocalActivo(localSeleccionado()!) ? 'bg-success' : 'bg-danger'">
              <i class="bi bi-clock me-1"></i>
              {{ isLocalActivo(localSeleccionado()!) ? 'Abierto' : 'Cerrado' }}
            </span>
          </div>
          <button type="button" class="btn-close" (click)="cerrarModal()"></button>
        </div>

        <!-- Imagen del local -->
        <div class="modal-image position-relative">
          <img [src]="getImagenLocal(0)"
               [alt]="localSeleccionado()!.nombre"
               class="w-100"
               style="height: 300px; object-fit: cover;">
        </div>

        <!-- Cuerpo del modal -->
        <div class="modal-body p-4">
          <div class="row g-4">

            <!-- Información principal -->
            <div class="col-md-8">
              <h2 class="modal-title h3 fw-bold text-primary mb-3">
                {{ localSeleccionado()!.nombre }}
              </h2>

              <!-- Información de contacto -->
              <div class="contact-info mb-4">
                <h5 class="fw-bold mb-3">
                  <i class="bi bi-info-circle text-primary me-2"></i>
                  Información de Contacto
                </h5>

                <div class="row g-3">
                  <div class="col-md-6">
                    <div class="contact-card p-3 bg-light rounded-3">
                      <i class="bi bi-geo-alt-fill text-primary fs-5 mb-2"></i>
                      <div class="fw-semibold">Dirección</div>
                      <div class="text-muted">{{ localSeleccionado()!.direccion }}, {{ localSeleccionado()!.ciudad }}</div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="contact-card p-3 bg-light rounded-3">
                      <i class="bi bi-telephone text-primary fs-5 mb-2"></i>
                      <div class="fw-semibold">Teléfono</div>
                      <div class="text-muted">{{ localSeleccionado()!.telefono }}</div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="contact-card p-3 bg-light rounded-3">
                      <i class="bi bi-envelope text-primary fs-5 mb-2"></i>
                      <div class="fw-semibold">Email</div>
                      <div class="text-muted">{{ localSeleccionado()!.email }}</div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="contact-card p-3 bg-light rounded-3">
                      <i class="bi bi-people text-primary fs-5 mb-2"></i>
                      <div class="fw-semibold">Capacidad</div>
                      <div class="text-success fw-bold">{{ localSeleccionado()!.capacidad }} personas</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Horarios de atención -->
              <div class="horarios mb-4">
                <h5 class="fw-bold mb-3">
                  <i class="bi bi-clock text-primary me-2"></i>
                  Horarios de Atención
                </h5>
                <div class="p-3 bg-success bg-opacity-10 rounded-3">
                  <div class="fw-semibold text-success">Horario</div>
                  <div class="text-muted">{{ formatearHorario(localSeleccionado()!.horarioApertura, localSeleccionado()!.horarioCierre) }}</div>
                </div>
              </div>
            </div>

            <!-- Panel lateral de acciones -->
            <div class="col-md-4">
              <div class="action-panel bg-primary bg-opacity-10 rounded-4 p-4">
                <h5 class="fw-bold text-primary mb-3">
                  <i class="bi bi-telephone-plus me-2"></i>
                  Contáctanos
                </h5>

                <div class="d-grid gap-3">
                  <button class="btn btn-primary btn-lg fw-semibold"
                          (click)="llamarLocal(localSeleccionado()!.telefono!)">
                    <i class="bi bi-telephone me-2"></i>
                    Llamar Ahora
                  </button>

                  <button class="btn btn-outline-primary"
                          (click)="enviarEmail(localSeleccionado()!.email!, localSeleccionado()!.nombre!)">
                    <i class="bi bi-envelope me-2"></i>
                    Enviar Email
                  </button>
                </div>

                <!-- Información adicional -->
                <div class="additional-info mt-4">
                  <h6 class="fw-bold mb-2">
                    <i class="bi bi-info-circle text-info me-2"></i>
                    Información Adicional
                  </h6>
                  <ul class="list-unstyled small text-muted">
                    <li class="mb-1">
                      <i class="bi bi-dot"></i>
                      Reservas disponibles todos los días
                    </li>
                    <li class="mb-1">
                      <i class="bi bi-dot"></i>
                      Eventos privados bajo consulta
                    </li>
                    <li class="mb-1">
                      <i class="bi bi-dot"></i>
                      Delivery sin costo mínimo
                    </li>
                    <li>
                      <i class="bi bi-dot"></i>
                      Métodos de pago: Efectivo y tarjetas
                    </li>
                  </ul>
                </div>

                <!-- Estado actual -->
                <div class="status-info mt-4 p-3 rounded-3"
                     [class]="isLocalActivo(localSeleccionado()!) ? 'bg-success bg-opacity-10' : 'bg-danger bg-opacity-10'">
                  <div class="d-flex align-items-center"
                       [class]="isLocalActivo(localSeleccionado()!) ? 'text-success' : 'text-danger'">
                    <i class="bi bi-clock-fill me-2"></i>
                    <span class="fw-semibold">
                      {{ isLocalActivo(localSeleccionado()!) ? '¡Estamos abiertos!' : 'Actualmente cerrado' }}
                    </span>
                  </div>
                  <small class="text-muted">
                    {{ isLocalActivo(localSeleccionado()!) ? 'Puedes visitarnos ahora' : 'Te esperamos en nuestros horarios de atención' }}
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
}
